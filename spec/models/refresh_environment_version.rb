require 'spec_helper'

class EnvVersionUnitTest
  describe 'Refresh Environment Version' do
    env_version = nil

    context 'TC01 - Add new record into EnvVersion table' do
      it 'Add new record into EnvVersion table' do
        env_version_count = EnvVersion.count
        env_version = EnvVersion.create(services: '{"services":[{"endpoints":[{"first_version":"Bamboo:21 SVN:17462","port":80,"subdomain":"dev-www","url":"http://dev-www.leapfrog.com/en-us/store/version.jsp"}],"env":"Dev","instances":"dev-www","name":"ATG","path":"/en-us/store/version.jsp"},{"endpoints":[{"first_version":"3.2.39-SNAPSHOT","port":8080,"subdomain":"emdlcsapp01","url":"http://emdlcsapp01.leapfrog.com:8080/customerservicetools/maven/versions.txt"},{"first_version":null,"port":8080,"subdomain":"emdlcsapp02","url":"http://emdlcsapp02.leapfrog.com:8080/customerservicetools/maven/versions.txt","error":"Network permission denied"}],"env":"Dev","instances":"emdlcsapp01,emdlcsapp02","name":"CSTools","path":":8080/customerservicetools/maven/versions.txt"},{"endpoints":[{"first_version":null,"port":8080,"subdomain":"dev-geo","url":"http://dev-geo.leapfrog.com:8080/geoip-lookup/maven/versions.txt","error":"Errno::ECONNRESET"}],"env":"Dev","instances":"dev-geo","name":"GeoIpLookup","path":":8080/geoip-lookup/maven/versions.txt"},{"endpoints":[{"first_version":"2.0.139","port":8080,"subdomain":"emdlcis","url":"http://emdlcis.leapfrog.com:8080/inmon/maven/versions.txt"},{"first_version":"2.0.139","port":8080,"subdomain":"emdlcis01","url":"http://emdlcis01.leapfrog.com:8080/inmon/maven/versions.txt"}],"env":"Dev","instances":"emdlcis,emdlcis01","name":"INMON-CIS","path":":8080/inmon/maven/versions.txt"},{"endpoints":[{"first_version":"2.0.139","port":8080,"subdomain":"emdlcis2","url":"http://emdlcis2.leapfrog.com:8080/inmon/maven/versions.txt"},{"first_version":"2.0.83","port":8080,"subdomain":"emdlcis2app01","url":"http://emdlcis2app01.leapfrog.com:8080/inmon/maven/versions.txt"},{"first_version":"2.0.83","port":8080,"subdomain":"emdlcis2app02","url":"http://emdlcis2app02.leapfrog.com:8080/inmon/maven/versions.txt"}],"env":"Dev","instances":"emdlcis2,emdlcis2app01,emdlcis2app02","name":"INMON-CIS2","path":":8080/inmon/maven/versions.txt"},{"endpoints":[{"first_version":"2.0.30","port":8080,"subdomain":"emdlclp01","url":"http://emdlclp01.leapfrog.com:8080/inmon/maven/versions.txt"}],"env":"Dev","instances":"emdlclp01","name":"INMON-CLP","path":":8080/inmon/maven/versions.txt"},{"endpoints":[{"first_version":null,"port":8085,"subdomain":"emdldlog","url":"http://emdldlog.leapfrog.com:8085/inmon/maven/versions.txt","error":"Network permission denied"},{"first_version":"2.0.75-SNAPSHOT","port":8085,"subdomain":"emdldlog01","url":"http://emdldlog01.leapfrog.com:8085/inmon/maven/versions.txt"},{"first_version":null,"port":8085,"subdomain":"emdldlog02","url":"http://emdldlog02.leapfrog.com:8085/inmon/maven/versions.txt","error":"Network permission denied"}],"env":"Dev","instances":"emdldlog,emdldlog01,emdldlog02","name":"INMON-DLOG","path":":8085/inmon/maven/versions.txt"},{"endpoints":[{"first_version":" 1.0.1.0","port":443,"subdomain":"dev-leaptv","url":"https://dev-leaptv.leapfrog.com/register/version.php"}],"env":"Dev","instances":"dev-leaptv","name":"LeapTV Register","path":"/register/version.php","protocol":"https://"},{"endpoints":[{"first_version":"1.18.0-SNAPSHOT","port":8090,"subdomain":"emdllfcam01","url":"http://emdllfcam01.leapfrog.com:8090/lfcam/maven/versions.txt"},{"first_version":null,"port":8090,"subdomain":"emdllfcam02","url":"http://emdllfcam02.leapfrog.com:8090/lfcam/maven/versions.txt","error":"Network permission denied"}],"env":"Dev","instances":"emdllfcam01,emdllfcam02","name":"LFCam","path":":8090/lfcam/maven/versions.txt"},{"endpoints":[{"first_version":"0.13","port":8080,"subdomain":"emdlpin01","url":"http://emdlpin01.leapfrog.com:8080/pingen/maven/versions.txt"}],"env":"Dev","instances":"emdlpin01","name":"PinGen","path":":8080/pingen/maven/versions.txt"},{"endpoints":[{"first_version":"3.2.40","port":8080,"subdomain":"emqlcsapp01","url":"http://emqlcsapp01.leapfrog.com:8080/customerservicetools/maven/versions.txt"},{"first_version":"3.2.40","port":8080,"subdomain":"emqlcsapp02","url":"http://emqlcsapp02.leapfrog.com:8080/customerservicetools/maven/versions.txt"}],"env":"QA","instances":"emqlcsapp01,emqlcsapp02","name":"CSTools","path":":8080/customerservicetools/maven/versions.txt"},{"endpoints":[{"first_version":"0.0.8","port":8080,"subdomain":"qa-geo","url":"http://qa-geo.leapfrog.com:8080/geoip-lookup/maven/versions.txt"}],"env":"QA","instances":"qa-geo","name":"GeoIpLookup","path":":8080/geoip-lookup/maven/versions.txt"},{"endpoints":[{"first_version":"2.0.139","port":8080,"subdomain":"emqlcis","url":"http://emqlcis.leapfrog.com:8080/inmon/maven/versions.txt"},{"first_version":"2.0.139","port":8080,"subdomain":"emqlcis01","url":"http://emqlcis01.leapfrog.com:8080/inmon/maven/versions.txt"},{"first_version":"2.0.139","port":8080,"subdomain":"emqlcis02","url":"http://emqlcis02.leapfrog.com:8080/inmon/maven/versions.txt"}],"env":"QA","instances":"emqlcis,emqlcis01,emqlcis02","name":"INMON-CIS","path":":8080/inmon/maven/versions.txt"},{"endpoints":[{"first_version":"2.0.139","port":8080,"subdomain":"emqlcis2","url":"http://emqlcis2.leapfrog.com:8080/inmon/maven/versions.txt"},{"first_version":"2.0.138","port":8080,"subdomain":"emqlcis2app01","url":"http://emqlcis2app01.leapfrog.com:8080/inmon/maven/versions.txt"},{"first_version":"2.0.138","port":8080,"subdomain":"emqlcis2app02","url":"http://emqlcis2app02.leapfrog.com:8080/inmon/maven/versions.txt"}],"env":"QA","instances":"emqlcis2,emqlcis2app01,emqlcis2app02","name":"INMON-CIS2","path":":8080/inmon/maven/versions.txt"},{"endpoints":[{"first_version":"2.0.139","port":8080,"subdomain":"emqlclp","url":"http://emqlclp.leapfrog.com:8080/inmon/maven/versions.txt"},{"first_version":"2.0.138","port":8080,"subdomain":"emqlclp01","url":"http://emqlclp01.leapfrog.com:8080/inmon/maven/versions.txt"},{"first_version":"2.0.138","port":8080,"subdomain":"emqlclp02","url":"http://emqlclp02.leapfrog.com:8080/inmon/maven/versions.txt"}],"env":"QA","instances":"emqlclp,emqlclp01,emqlclp02","name":"INMON-CLP","path":":8080/inmon/maven/versions.txt"},{"endpoints":[{"first_version":"2.0.139","port":8085,"subdomain":"emqldlog","url":"http://emqldlog.leapfrog.com:8085/inmon/maven/versions.txt"},{"first_version":"2.0.139","port":8085,"subdomain":"emqldlog01","url":"http://emqldlog01.leapfrog.com:8085/inmon/maven/versions.txt"},{"first_version":"2.0.139","port":8085,"subdomain":"emqldlog02","url":"http://emqldlog02.leapfrog.com:8085/inmon/maven/versions.txt"}],"env":"QA","instances":"emqldlog,emqldlog01,emqldlog02","name":"INMON-DLOG","path":":8085/inmon/maven/versions.txt"},{"endpoints":[{"first_version":" 1.0.1.0","port":443,"subdomain":"qa-leaptv","url":"https://qa-leaptv.leapfrog.com/register/version.php"}],"env":"QA","instances":"qa-leaptv","name":"LeapTV Register","path":"/register/version.php","protocol":"https://"},{"endpoints":[{"first_version":"1.18.0","port":8090,"subdomain":"emqllfcam01","url":"http://emqllfcam01.leapfrog.com:8090/lfcam/maven/versions.txt"},{"first_version":"1.18.0","port":8090,"subdomain":"emqllfcam02","url":"http://emqllfcam02.leapfrog.com:8090/lfcam/maven/versions.txt"}],"env":"QA","instances":"emqllfcam01,emqllfcam02","name":"LFCam","path":":8090/lfcam/maven/versions.txt"},{"endpoints":[{"first_version":"0.13","port":8080,"subdomain":"emqlpin01","url":"http://emqlpin01.leapfrog.com:8080/pingen/maven/versions.txt"}],"env":"QA","instances":"emqlpin01","name":"PinGen","path":":8080/pingen/maven/versions.txt"},{"endpoints":[{"first_version":"Bamboo:107 SVN:17465","port":80,"subdomain":"uat-www","url":"http://uat-www.leapfrog.com/en-us/store/version.jsp"}],"env":"UAT","instances":"uat-www","name":"ATG","path":"/en-us/store/version.jsp"},{"endpoints":[{"first_version":"0.0.7","port":8080,"subdomain":"staging-geo","url":"http://staging-geo.leapfrog.com:8080/geoip-lookup/maven/versions.txt"}],"env":"Staging","instances":"staging-geo","name":"GeoIpLookup","path":":8080/geoip-lookup/maven/versions.txt"},{"endpoints":[{"first_version":"1.27.38","port":8080,"subdomain":"emrlcis2app01","url":"http://emrlcis2app01.leapfrog.com:8080/inmon/maven/versions.txt"}],"env":"Staging","instances":"emrlcis2app01","name":"INMON-CIS2","path":":8080/inmon/maven/versions.txt"},{"endpoints":[{"first_version":" 1.0.1.0","port":443,"subdomain":"staging-leaptv","url":"https://staging-leaptv.leapfrog.com/register/version.php"}],"env":"Staging","instances":"staging-leaptv","name":"LeapTV Register","path":"/register/version.php","protocol":"https://"},{"endpoints":[{"first_version":"Bamboo:107 SVN:17465","port":80,"subdomain":"www","url":"http://www.leapfrog.com/en-us/store/version.jsp"}],"env":"Prod","instances":"www","name":"ATG","path":"/en-us/store/version.jsp"},{"endpoints":[{"first_version":"3.2.37.2","port":8080,"subdomain":"evplcsapp01","url":"http://evplcsapp01.leapfrog.com:8080/customerservicetools/maven/versions.txt"},{"first_version":"3.2.37.2","port":8080,"subdomain":"evplcsapp02","url":"http://evplcsapp02.leapfrog.com:8080/customerservicetools/maven/versions.txt"},{"first_version":"3.2.37.2","port":8080,"subdomain":"evplcsapp03","url":"http://evplcsapp03.leapfrog.com:8080/customerservicetools/maven/versions.txt"},{"first_version":"3.2.37.2","port":8080,"subdomain":"evplcsapp04","url":"http://evplcsapp04.leapfrog.com:8080/customerservicetools/maven/versions.txt"}],"env":"Prod","instances":"evplcsapp01,evplcsapp02,evplcsapp03,evplcsapp04","name":"CSTools","path":":8080/customerservicetools/maven/versions.txt"},{"endpoints":[{"first_version":"0.0.7","port":8080,"subdomain":"geo","url":"http://geo.leapfrog.com:8080/geoip-lookup/maven/versions.txt"}],"env":"Prod","instances":"geo","name":"GeoIpLookup","path":":8080/geoip-lookup/maven/versions.txt"},{"endpoints":[{"first_version":"2.0.136","port":8080,"subdomain":"evplcis","url":"http://evplcis.leapfrog.com:8080/inmon/maven/versions.txt"},{"first_version":"2.0.136","port":8080,"subdomain":"evplcis01","url":"http://evplcis01.leapfrog.com:8080/inmon/maven/versions.txt"},{"first_version":"2.0.136","port":8080,"subdomain":"evplcis02","url":"http://evplcis02.leapfrog.com:8080/inmon/maven/versions.txt"},{"first_version":"2.0.136","port":8080,"subdomain":"evplcis03","url":"http://evplcis03.leapfrog.com:8080/inmon/maven/versions.txt"},{"first_version":"2.0.136","port":8080,"subdomain":"evplcis04","url":"http://evplcis04.leapfrog.com:8080/inmon/maven/versions.txt"},{"first_version":"2.0.136","port":8080,"subdomain":"evplcis05","url":"http://evplcis05.leapfrog.com:8080/inmon/maven/versions.txt"},{"first_version":"2.0.136","port":8080,"subdomain":"evplcis06","url":"http://evplcis06.leapfrog.com:8080/inmon/maven/versions.txt"},{"first_version":null,"port":8080,"subdomain":"evplcis07","url":"http://evplcis07.leapfrog.com:8080/inmon/maven/versions.txt","error":"Network permission denied"},{"first_version":null,"port":8080,"subdomain":"evplcis08","url":"http://evplcis08.leapfrog.com:8080/inmon/maven/versions.txt","error":"Network permission denied"}],"env":"Prod","instances":"evplcis,evplcis01,evplcis02,evplcis03,evplcis04,evplcis05,evplcis06,evplcis07,evplcis08","name":"INMON-CIS","path":":8080/inmon/maven/versions.txt"},{"endpoints":[{"first_version":"2.0.136","port":8080,"subdomain":"evplcis2","url":"http://evplcis2.leapfrog.com:8080/inmon/maven/versions.txt"},{"first_version":"2.0.136","port":8080,"subdomain":"evplcis2app01","url":"http://evplcis2app01.leapfrog.com:8080/inmon/maven/versions.txt"},{"first_version":"2.0.136","port":8080,"subdomain":"evplcis2app02","url":"http://evplcis2app02.leapfrog.com:8080/inmon/maven/versions.txt"},{"first_version":"2.0.136","port":8080,"subdomain":"evplcis2app03","url":"http://evplcis2app03.leapfrog.com:8080/inmon/maven/versions.txt"},{"first_version":"2.0.136","port":8080,"subdomain":"evplcis2app04","url":"http://evplcis2app04.leapfrog.com:8080/inmon/maven/versions.txt"},{"first_version":"2.0.136","port":8080,"subdomain":"evplcis2app05","url":"http://evplcis2app05.leapfrog.com:8080/inmon/maven/versions.txt"},{"first_version":"2.0.136","port":8080,"subdomain":"evplcis2app06","url":"http://evplcis2app06.leapfrog.com:8080/inmon/maven/versions.txt"}],"env":"Prod","instances":"evplcis2,evplcis2app01,evplcis2app02,evplcis2app03,evplcis2app04,evplcis2app05,evplcis2app06","name":"INMON-CIS2","path":":8080/inmon/maven/versions.txt"},{"endpoints":[{"first_version":"2.0.136","port":8080,"subdomain":"evplclp","url":"http://evplclp.leapfrog.com:8080/inmon/maven/versions.txt"},{"first_version":"2.0.136","port":8080,"subdomain":"evplclp01","url":"http://evplclp01.leapfrog.com:8080/inmon/maven/versions.txt"},{"first_version":"2.0.136","port":8080,"subdomain":"evplclp02","url":"http://evplclp02.leapfrog.com:8080/inmon/maven/versions.txt"},{"first_version":"2.0.136","port":8080,"subdomain":"evplclp03","url":"http://evplclp03.leapfrog.com:8080/inmon/maven/versions.txt"},{"first_version":"2.0.136","port":8080,"subdomain":"evplclp04","url":"http://evplclp04.leapfrog.com:8080/inmon/maven/versions.txt"}],"env":"Prod","instances":"evplclp,evplclp01,evplclp02,evplclp03,evplclp04","name":"INMON-CLP","path":":8080/inmon/maven/versions.txt"},{"endpoints":[{"first_version":"2.0.119","port":8085,"subdomain":"evpldlog","url":"http://evpldlog.leapfrog.com:8085/inmon/maven/versions.txt"},{"first_version":"2.0.119","port":8085,"subdomain":"evpldlog01","url":"http://evpldlog01.leapfrog.com:8085/inmon/maven/versions.txt"},{"first_version":"2.0.119","port":8085,"subdomain":"evpldlog02","url":"http://evpldlog02.leapfrog.com:8085/inmon/maven/versions.txt"},{"first_version":"2.0.119","port":8085,"subdomain":"evpldlog03","url":"http://evpldlog03.leapfrog.com:8085/inmon/maven/versions.txt"},{"first_version":"2.0.119","port":8085,"subdomain":"evpldlog04","url":"http://evpldlog04.leapfrog.com:8085/inmon/maven/versions.txt"},{"first_version":"2.0.119","port":8085,"subdomain":"evpldlog05","url":"http://evpldlog05.leapfrog.com:8085/inmon/maven/versions.txt"},{"first_version":"2.0.119","port":8085,"subdomain":"evpldlog06","url":"http://evpldlog06.leapfrog.com:8085/inmon/maven/versions.txt"}],"env":"Prod","instances":"evpldlog,evpldlog01,evpldlog02,evpldlog03,evpldlog04,evpldlog05,evpldlog06","name":"INMON-DLOG","path":":8085/inmon/maven/versions.txt"},{"endpoints":[{"first_version":" 1.0.1.0","port":443,"subdomain":"leaptv","url":"https://leaptv.leapfrog.com/register/version.php"}],"env":"Prod","instances":"leaptv","name":"LeapTV Register","path":"/register/version.php","protocol":"https://"},{"endpoints":[{"first_version":"1.18.0","port":8090,"subdomain":"evpllfcam","url":"http://evpllfcam.leapfrog.com:8090/lfcam/maven/versions.txt"},{"first_version":"1.18.0","port":8090,"subdomain":"evpllfcam01","url":"http://evpllfcam01.leapfrog.com:8090/lfcam/maven/versions.txt"},{"first_version":"1.18.0","port":8090,"subdomain":"evpllfcam02","url":"http://evpllfcam02.leapfrog.com:8090/lfcam/maven/versions.txt"},{"first_version":"1.18.0","port":8090,"subdomain":"evpllfcam03","url":"http://evpllfcam03.leapfrog.com:8090/lfcam/maven/versions.txt"},{"first_version":"1.18.0","port":8090,"subdomain":"evpllfcam04","url":"http://evpllfcam04.leapfrog.com:8090/lfcam/maven/versions.txt"},{"first_version":"1.18.0","port":8090,"subdomain":"evpllfcam05","url":"http://evpllfcam05.leapfrog.com:8090/lfcam/maven/versions.txt"},{"first_version":"1.18.0","port":8090,"subdomain":"evpllfcam06","url":"http://evpllfcam06.leapfrog.com:8090/lfcam/maven/versions.txt"},{"first_version":null,"port":8090,"subdomain":"evpllfcam07","url":"http://evpllfcam07.leapfrog.com:8090/lfcam/maven/versions.txt","error":"Network permission denied"},{"first_version":null,"port":8090,"subdomain":"evpllfcam08","url":"http://evpllfcam08.leapfrog.com:8090/lfcam/maven/versions.txt","error":"Network permission denied"}],"env":"Prod","instances":"evpllfcam,evpllfcam01,evpllfcam02,evpllfcam03,evpllfcam04,evpllfcam05,evpllfcam06,evpllfcam07,evpllfcam08","name":"LFCam","path":":8090/lfcam/maven/versions.txt"},{"endpoints":[{"first_version":"0.5","port":8080,"subdomain":"evplpin01","url":"http://evplpin01.leapfrog.com:8080/pingen/maven/versions.txt"}],"env":"Prod","instances":"evplpin01","name":"PinGen","path":":8080/pingen/maven/versions.txt"}]}'.to_json)
        expect(EnvVersion.count).to eq(env_version_count + 1)
      end
    end

    after :all do
      env_version.destroy
    end
  end
end
